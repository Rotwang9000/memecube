<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Tag Cluster Demo</title>
	<style>
		body {
			margin: 0;
			padding: 0;
			overflow: hidden;
			background-color: #000;
			color: #fff;
			font-family: 'Arial', sans-serif;
		}
		
		canvas {
			display: block;
			width: 100vw;
			height: 100vh;
		}
		
		#controls {
			position: absolute;
			top: 20px;
			right: 20px;
			background-color: rgba(0, 0, 0, 0.7);
			padding: 15px;
			border-radius: 5px;
			z-index: 100;
			width: 300px;
		}
		
		.row {
			margin-bottom: 10px;
			display: flex;
			align-items: center;
		}
		
		label {
			flex: 1;
			margin-right: 10px;
		}
		
		input, button {
			flex: 2;
		}
		
		button {
			background-color: #4CAF50;
			color: white;
			border: none;
			padding: 8px 12px;
			cursor: pointer;
			border-radius: 3px;
			transition: background-color 0.3s;
		}
		
		button:hover {
			background-color: #45a049;
		}
		
		button:disabled {
			background-color: #cccccc;
			cursor: not-allowed;
		}
		
		#stats {
			position: absolute;
			bottom: 20px;
			left: 20px;
			background-color: rgba(0, 0, 0, 0.7);
			padding: 10px;
			border-radius: 5px;
			z-index: 100;
		}
		
		h2 {
			margin-top: 0;
			margin-bottom: 15px;
			text-align: center;
		}
	</style>
</head>
<body>
	<canvas id="canvas"></canvas>
	
	<div id="controls">
		<h2>Tag Cluster Demo</h2>
		
		<div class="row">
			<label for="token-name">Token Name:</label>
			<input type="text" id="token-name" placeholder="Enter token name">
		</div>
		
		<div class="row">
			<label for="token-size">Token Size:</label>
			<input type="range" id="token-size" min="0.5" max="2" step="0.1" value="1">
			<span id="size-value">1.0</span>
		</div>
		
		<div class="row">
			<button id="add-token">Add Token</button>
			<button id="random-token">Random Token</button>
		</div>
		
		<div class="row">
			<button id="start-demo">Start Demo</button>
			<button id="stop-demo">Stop Demo</button>
		</div>
		
		<div class="row">
			<button id="toggle-rotation">Toggle Auto-Rotation</button>
		</div>
	</div>
	
	<div id="stats">
		<div>Tokens: <span id="token-count">0</span></div>
		<div>FPS: <span id="fps">0</span></div>
	</div>
	
	<script type="importmap">
	{
		"imports": {
			"three": "https://unpkg.com/three@0.157.0/build/three.module.js",
			"three/addons/": "https://unpkg.com/three@0.157.0/examples/jsm/"
		}
	}
	</script>
	
	<script type="module">
		import * as THREE from 'three';
		import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
		import { TagCluster } from './tag-cluster.js';
		
		// Set up scene
		const canvas = document.getElementById('canvas');
		const scene = new THREE.Scene();
		const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
		camera.position.z = 10;
		
		const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
		renderer.setSize(window.innerWidth, window.innerHeight);
		renderer.setPixelRatio(window.devicePixelRatio);
		renderer.setClearColor(0x000000);
		
		// Set up controls
		const controls = new OrbitControls(camera, renderer.domElement);
		controls.enableDamping = true;
		controls.dampingFactor = 0.05;
		
		// Set up lighting
		const ambientLight = new THREE.AmbientLight(0x404040);
		scene.add(ambientLight);
		
		const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
		directionalLight.position.set(1, 1, 1);
		scene.add(directionalLight);
		
		// Add subtle point lights for better 3D appearance
		const pointLight1 = new THREE.PointLight(0x3366ff, 0.5, 20);
		pointLight1.position.set(5, 5, 5);
		scene.add(pointLight1);
		
		const pointLight2 = new THREE.PointLight(0xff6633, 0.5, 20);
		pointLight2.position.set(-5, -5, -5);
		scene.add(pointLight2);
		
		// Set up tag cluster
		const tagCluster = new TagCluster(scene, camera, {
			maxTags: 50,
			initialTagCount: 5,
			fontPath: '/fonts/helvetiker_bold.typeface.json'
		});
		
		// Set up sample tokens
		const sampleTokens = [
			{ chainId: 'ethereum', tokenAddress: '0x1234', symbol: 'BTC', fdv: 1000000000000 },
			{ chainId: 'ethereum', tokenAddress: '0x2345', symbol: 'ETH', fdv: 500000000000 },
			{ chainId: 'ethereum', tokenAddress: '0x3456', symbol: 'SOL', fdv: 50000000000 },
			{ chainId: 'ethereum', tokenAddress: '0x4567', symbol: 'DOGE', fdv: 20000000000 },
			{ chainId: 'ethereum', tokenAddress: '0x5678', symbol: 'SHIB', fdv: 10000000000 },
			{ chainId: 'ethereum', tokenAddress: '0x6789', symbol: 'PEPE', fdv: 5000000000 },
			{ chainId: 'ethereum', tokenAddress: '0x7890', symbol: 'FLOKI', fdv: 1000000000 },
			{ chainId: 'ethereum', tokenAddress: '0x8901', symbol: 'BONK', fdv: 500000000 },
			{ chainId: 'ethereum', tokenAddress: '0x9012', symbol: 'WIF', fdv: 250000000 },
			{ chainId: 'ethereum', tokenAddress: '0x0123', symbol: 'MEME', fdv: 100000000 }
		];
		
		// Initialize tag cluster with sample tokens
		tagCluster.initialize(sampleTokens);
		
		// Set up UI controls
		const tokenNameInput = document.getElementById('token-name');
		const tokenSizeInput = document.getElementById('token-size');
		const sizeValueSpan = document.getElementById('size-value');
		const addTokenButton = document.getElementById('add-token');
		const randomTokenButton = document.getElementById('random-token');
		const startDemoButton = document.getElementById('start-demo');
		const stopDemoButton = document.getElementById('stop-demo');
		const toggleRotationButton = document.getElementById('toggle-rotation');
		
		const tokenCountSpan = document.getElementById('token-count');
		const fpsSpan = document.getElementById('fps');
		
		// Update size value display
		tokenSizeInput.addEventListener('input', () => {
			sizeValueSpan.textContent = tokenSizeInput.value;
		});
		
		// Add token button
		addTokenButton.addEventListener('click', () => {
			const name = tokenNameInput.value.trim();
			if (name) {
				const size = parseFloat(tokenSizeInput.value);
				const url = `https://dexscreener.com/ethereum/${name.toLowerCase()}`;
				
				// Create token object
				const token = {
					chainId: 'ethereum',
					tokenAddress: `0x${Math.floor(Math.random() * 10000).toString(16)}`,
					symbol: name,
					fdv: Math.random() * 1000000000,
					liquidity: { usd: Math.random() * 1000000 },
					priceChange: { h24: (Math.random() * 40) - 20 } // -20% to +20%
				};
				
				// Add token to cluster
				tagCluster.addTokenTag(token);
				
				// Clear input
				tokenNameInput.value = '';
			}
		});
		
		// Random token button
		randomTokenButton.addEventListener('click', () => {
			// List of random token names
			const tokenNames = [
				'TURBO', 'SHIBA', 'ELON', 'APE', 'MOON', 'DEGEN', 'BASED',
				'CHAD', 'WOJAK', 'PEPE2', 'DOGE2', 'CAT', 'FROG', 'ROCKET'
			];
			
			// Select random token
			const name = tokenNames[Math.floor(Math.random() * tokenNames.length)];
			
			// Create token object
			const token = {
				chainId: 'ethereum',
				tokenAddress: `0x${Math.floor(Math.random() * 10000).toString(16)}`,
				symbol: name,
				fdv: Math.random() * 1000000000,
				liquidity: { usd: Math.random() * 1000000 },
				priceChange: { h24: (Math.random() * 40) - 20 } // -20% to +20%
			};
			
			// Add token to cluster
			tagCluster.addTokenTag(token);
		});
		
		// Demo interval ID
		let demoIntervalId = null;
		
		// Start demo button
		startDemoButton.addEventListener('click', () => {
			if (demoIntervalId) return;
			
			// Add random tokens periodically
			demoIntervalId = setInterval(() => {
				// Check if we've reached max tokens
				if (tagCluster.tokenTags.size >= tagCluster.options.maxTags - 1) {
					// Remove a random token
					const tagIds = Array.from(tagCluster.tokenTags.keys());
					const randomId = tagIds[Math.floor(Math.random() * tagIds.length)];
					tagCluster.removeTokenTag(randomId);
				}
				
				randomTokenButton.click();
			}, 3000);
			
			startDemoButton.disabled = true;
			stopDemoButton.disabled = false;
		});
		
		// Stop demo button
		stopDemoButton.addEventListener('click', () => {
			if (demoIntervalId) {
				clearInterval(demoIntervalId);
				demoIntervalId = null;
			}
			
			startDemoButton.disabled = false;
			stopDemoButton.disabled = true;
		});
		
		// Scene auto-rotation
		let autoRotate = true;
		
		// Toggle rotation button
		toggleRotationButton.addEventListener('click', () => {
			autoRotate = !autoRotate;
			toggleRotationButton.textContent = autoRotate ? 'Disable Auto-Rotation' : 'Enable Auto-Rotation';
		});
		
		// Animation loop
		let lastTime = 0;
		let frameCount = 0;
		let lastFpsUpdate = 0;
		
		function animate(time) {
			requestAnimationFrame(animate);
			
			// Update tagCluster
			tagCluster.update();
			
			// Auto-rotate scene if enabled
			if (autoRotate) {
				scene.rotation.y += 0.001;
			}
			
			// Update controls
			controls.update();
			
			// Render scene
			renderer.render(scene, camera);
			
			// Update stats
			frameCount++;
			
			if (time - lastFpsUpdate > 1000) {
				const fps = Math.round(frameCount * 1000 / (time - lastFpsUpdate));
				fpsSpan.textContent = fps;
				frameCount = 0;
				lastFpsUpdate = time;
				
				// Update token count
				tokenCountSpan.textContent = tagCluster.tokenTags.size;
			}
			
			lastTime = time;
		}
		
		// Handle window resize
		window.addEventListener('resize', () => {
			camera.aspect = window.innerWidth / window.innerHeight;
			camera.updateProjectionMatrix();
			renderer.setSize(window.innerWidth, window.innerHeight);
		});
		
		// Start animation
		animate(0);
	</script>
</body>
</html> 